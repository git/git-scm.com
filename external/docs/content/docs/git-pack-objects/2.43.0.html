---
### DO NOT EDIT! Generated by script/update-docs.rb

category: manual
section: documentation
subsection: manual
title: Git - git-pack-objects Documentation
docname: git-pack-objects
version: 2.43.0
aliases:
- "/docs/git-pack-objects/2.43.0/index.html"
- "/docs/git-pack-objects/2.43.1/index.html"
- "/docs/git-pack-objects/2.43.2/index.html"
- "/docs/git-pack-objects/2.43.3/index.html"
- "/docs/git-pack-objects/2.43.4/index.html"
- "/docs/git-pack-objects/2.43.5/index.html"
- "/docs/git-pack-objects/2.44.0/index.html"
- "/docs/git-pack-objects/2.44.1/index.html"
- "/docs/git-pack-objects/2.44.2/index.html"
- "/docs/git-pack-objects/2.45.0/index.html"
- "/docs/git-pack-objects/2.45.1/index.html"
- "/docs/git-pack-objects/2.45.2/index.html"
- "/docs/git-pack-objects/2.46.0/index.html"
- "/docs/git-pack-objects/2.46.1/index.html"
- "/docs/git-pack-objects/2.46.2/index.html"
- "/docs/git-pack-objects/2.47.0/index.html"
---
<div class="sect1">
<h2 id="_name"><a class="anchor" href="#_name"></a>NAME</h2>
<div class="sectionbody">
<div class="paragraph">
<p>git-pack-objects - Create a packed archive of objects</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis"><a class="anchor" href="#_synopsis"></a>SYNOPSIS</h2>
<div class="sectionbody">
<div class="verseblock">
<pre class="content"><em>git pack-objects</em> [-q | --progress | --all-progress] [--all-progress-implied]
	[--no-reuse-delta] [--delta-base-offset] [--non-empty]
	[--local] [--incremental] [--window=&lt;n&gt;] [--depth=&lt;n&gt;]
	[--revs [--unpacked | --all]] [--keep-pack=&lt;pack-name&gt;]
	[--cruft] [--cruft-expiration=&lt;time&gt;]
	[--stdout [--filter=&lt;filter-spec&gt;] | &lt;base-name&gt;]
	[--shallow] [--keep-true-parents] [--[no-]sparse] &lt; &lt;object-list&gt;</pre>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description"><a class="anchor" href="#_description"></a>DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reads list of objects from the standard input, and writes either one or
more packed archives with the specified base-name to disk, or a packed
archive to the standard output.</p>
</div>
<div class="paragraph">
<p>A packed archive is an efficient way to transfer a set of objects
between two repositories as well as an access efficient archival
format.  In a packed archive, an object is either stored as a
compressed whole or as a difference from some other object.
The latter is often called a delta.</p>
</div>
<div class="paragraph">
<p>The packed archive format (.pack) is designed to be self-contained
so that it can be unpacked without any further information. Therefore,
each object that a delta depends upon must be present within the pack.</p>
</div>
<div class="paragraph">
<p>A pack index file (.idx) is generated for fast, random access to the
objects in the pack. Placing both the index file (.idx) and the packed
archive (.pack) in the pack/ subdirectory of $GIT_OBJECT_DIRECTORY (or
any of the directories on $GIT_ALTERNATE_OBJECT_DIRECTORIES)
enables Git to read from the pack archive.</p>
</div>
<div class="paragraph">
<p>The <em>git unpack-objects</em> command can read the packed archive and
expand the objects contained in the pack into "one-file
one-object" format; this is typically done by the smart-pull
commands when a pack is created on-the-fly for efficient network
transport by their peers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_options"><a class="anchor" href="#_options"></a>OPTIONS</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt-base-name"> <a class="anchor" href="#Documentation/git-pack-objects.txt-base-name"></a>base-name </dt>
<dd>
<p>Write into pairs of files (.pack and .idx), using
&lt;base-name&gt; to determine the name of the created file.
When this option is used, the two files in a pair are written in
&lt;base-name&gt;-&lt;SHA-1&gt;.{pack,idx} files.  &lt;SHA-1&gt; is a hash
based on the pack content and is written to the standard
output of the command.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---stdout"> <a class="anchor" href="#Documentation/git-pack-objects.txt---stdout"></a>--stdout </dt>
<dd>
<p>Write the pack contents (what would have been written to
.pack file) out to the standard output.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---revs"> <a class="anchor" href="#Documentation/git-pack-objects.txt---revs"></a>--revs </dt>
<dd>
<p>Read the revision arguments from the standard input, instead of
individual object names.  The revision arguments are processed
the same way as <em>git rev-list</em> with the <code>--objects</code> flag
uses its <code>commit</code> arguments to build the list of objects it
outputs.  The objects on the resulting list are packed.
Besides revisions, <code>--not</code> or <code>--shallow &lt;SHA-1&gt;</code> lines are
also accepted.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---unpacked"> <a class="anchor" href="#Documentation/git-pack-objects.txt---unpacked"></a>--unpacked </dt>
<dd>
<p>This implies <code>--revs</code>.  When processing the list of
revision arguments read from the standard input, limit
the objects packed to those that are not already packed.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---all"> <a class="anchor" href="#Documentation/git-pack-objects.txt---all"></a>--all </dt>
<dd>
<p>This implies <code>--revs</code>.  In addition to the list of
revision arguments read from the standard input, pretend
as if all refs under <code>refs/</code> are specified to be
included.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---include-tag"> <a class="anchor" href="#Documentation/git-pack-objects.txt---include-tag"></a>--include-tag </dt>
<dd>
<p>Include unasked-for annotated tags if the object they
reference was included in the resulting packfile.  This
can be useful to send new tags to native Git clients.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---stdin-packs"> <a class="anchor" href="#Documentation/git-pack-objects.txt---stdin-packs"></a>--stdin-packs </dt>
<dd>
<p>Read the basenames of packfiles (e.g., <code>pack-1234abcd.pack</code>)
from the standard input, instead of object names or revision
arguments. The resulting pack contains all objects listed in the
included packs (those not beginning with <code>^</code>), excluding any
objects listed in the excluded packs (beginning with <code>^</code>).</p>
<div class="paragraph">
<p>Incompatible with <code>--revs</code>, or options that imply <code>--revs</code> (such as
<code>--all</code>), with the exception of <code>--unpacked</code>, which is compatible.</p>
</div>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---cruft"> <a class="anchor" href="#Documentation/git-pack-objects.txt---cruft"></a>--cruft </dt>
<dd>
<p>Packs unreachable objects into a separate "cruft" pack, denoted
by the existence of a <code>.mtimes</code> file. Typically used by <code>git
repack --cruft</code>. Callers provide a list of pack names and
indicate which packs will remain in the repository, along with
which packs will be deleted (indicated by the <code>-</code> prefix). The
contents of the cruft pack are all objects not contained in the
surviving packs which have not exceeded the grace period (see
<code>--cruft-expiration</code> below), or which have exceeded the grace
period, but are reachable from an other object which hasn&#8217;t.</p>
<div class="paragraph">
<p>When the input lists a pack containing all reachable objects (and lists
all other packs as pending deletion), the corresponding cruft pack will
contain all unreachable objects (with mtime newer than the
<code>--cruft-expiration</code>) along with any unreachable objects whose mtime is
older than the <code>--cruft-expiration</code>, but are reachable from an
unreachable object whose mtime is newer than the <code>--cruft-expiration</code>).</p>
</div>
<div class="paragraph">
<p>Incompatible with <code>--unpack-unreachable</code>, <code>--keep-unreachable</code>,
<code>--pack-loose-unreachable</code>, <code>--stdin-packs</code>, as well as any other
options which imply <code>--revs</code>.</p>
</div>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---cruft-expirationltapproxidategt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---cruft-expirationltapproxidategt"></a>--cruft-expiration=&lt;approxidate&gt; </dt>
<dd>
<p>If specified, objects are eliminated from the cruft pack if they
have an mtime older than <code>&lt;approxidate&gt;</code>. If unspecified (and
given <code>--cruft</code>), then no objects are eliminated.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---windowltngt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---windowltngt"></a>--window=&lt;n&gt; </dt>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---depthltngt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---depthltngt"></a>--depth=&lt;n&gt; </dt>
<dd>
<p>These two options affect how the objects contained in
the pack are stored using delta compression.  The
objects are first internally sorted by type, size and
optionally names and compared against the other objects
within --window to see if using delta compression saves
space.  --depth limits the maximum delta depth; making
it too deep affects the performance on the unpacker
side, because delta data needs to be applied that many
times to get to the necessary object.</p>
<div class="paragraph">
<p>The default value for --window is 10 and --depth is 50. The maximum
depth is 4095.</p>
</div>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---window-memoryltngt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---window-memoryltngt"></a>--window-memory=&lt;n&gt; </dt>
<dd>
<p>This option provides an additional limit on top of <code>--window</code>;
the window size will dynamically scale down so as to not take
up more than <em>&lt;n&gt;</em> bytes in memory.  This is useful in
repositories with a mix of large and small objects to not run
out of memory with a large window, but still be able to take
advantage of the large window for the smaller objects.  The
size can be suffixed with "k", "m", or "g".
<code>--window-memory=0</code> makes memory usage unlimited.  The default
is taken from the <code>pack.windowMemory</code> configuration variable.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---max-pack-sizeltngt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---max-pack-sizeltngt"></a>--max-pack-size=&lt;n&gt; </dt>
<dd>
<p>In unusual scenarios, you may not be able to create files
larger than a certain size on your filesystem, and this option
can be used to tell the command to split the output packfile
into multiple independent packfiles, each not larger than the
given size. The size can be suffixed with
"k", "m", or "g". The minimum size allowed is limited to 1 MiB.
The default is unlimited, unless the config variable
<code>pack.packSizeLimit</code> is set. Note that this option may result in
a larger and slower repository; see the discussion in
<code>pack.packSizeLimit</code>.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---honor-pack-keep"> <a class="anchor" href="#Documentation/git-pack-objects.txt---honor-pack-keep"></a>--honor-pack-keep </dt>
<dd>
<p>This flag causes an object already in a local pack that
has a .keep file to be ignored, even if it would have
otherwise been packed.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---keep-packltpack-namegt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---keep-packltpack-namegt"></a>--keep-pack=&lt;pack-name&gt; </dt>
<dd>
<p>This flag causes an object already in the given pack to be
ignored, even if it would have otherwise been
packed. <code>&lt;pack-name&gt;</code> is the pack file name without
leading directory (e.g. <code>pack-123.pack</code>). The option could be
specified multiple times to keep multiple packs.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---incremental"> <a class="anchor" href="#Documentation/git-pack-objects.txt---incremental"></a>--incremental </dt>
<dd>
<p>This flag causes an object already in a pack to be ignored
even if it would have otherwise been packed.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---local"> <a class="anchor" href="#Documentation/git-pack-objects.txt---local"></a>--local </dt>
<dd>
<p>This flag causes an object that is borrowed from an alternate
object store to be ignored even if it would have otherwise been
packed.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---non-empty"> <a class="anchor" href="#Documentation/git-pack-objects.txt---non-empty"></a>--non-empty </dt>
<dd>
<p>Only create a packed archive if it would contain at
least one object.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---progress"> <a class="anchor" href="#Documentation/git-pack-objects.txt---progress"></a>--progress </dt>
<dd>
<p>Progress status is reported on the standard error stream
by default when it is attached to a terminal, unless -q
is specified. This flag forces progress status even if
the standard error stream is not directed to a terminal.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---all-progress"> <a class="anchor" href="#Documentation/git-pack-objects.txt---all-progress"></a>--all-progress </dt>
<dd>
<p>When --stdout is specified then progress report is
displayed during the object count and compression phases
but inhibited during the write-out phase. The reason is
that in some cases the output stream is directly linked
to another command which may wish to display progress
status of its own as it processes incoming pack data.
This flag is like --progress except that it forces progress
report for the write-out phase as well even if --stdout is
used.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---all-progress-implied"> <a class="anchor" href="#Documentation/git-pack-objects.txt---all-progress-implied"></a>--all-progress-implied </dt>
<dd>
<p>This is used to imply --all-progress whenever progress display
is activated.  Unlike --all-progress this flag doesn&#8217;t actually
force any progress display by itself.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt--q"> <a class="anchor" href="#Documentation/git-pack-objects.txt--q"></a>-q </dt>
<dd>
<p>This flag makes the command not to report its progress
on the standard error stream.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---no-reuse-delta"> <a class="anchor" href="#Documentation/git-pack-objects.txt---no-reuse-delta"></a>--no-reuse-delta </dt>
<dd>
<p>When creating a packed archive in a repository that
has existing packs, the command reuses existing deltas.
This sometimes results in a slightly suboptimal pack.
This flag tells the command not to reuse existing deltas
but compute them from scratch.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---no-reuse-object"> <a class="anchor" href="#Documentation/git-pack-objects.txt---no-reuse-object"></a>--no-reuse-object </dt>
<dd>
<p>This flag tells the command not to reuse existing object data at all,
including non deltified object, forcing recompression of everything.
This implies --no-reuse-delta. Useful only in the obscure case where
wholesale enforcement of a different compression level on the
packed data is desired.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---compressionltngt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---compressionltngt"></a>--compression=&lt;n&gt; </dt>
<dd>
<p>Specifies compression level for newly-compressed data in the
generated pack.  If not specified,  pack compression level is
determined first by pack.compression,  then by core.compression,
and defaults to -1,  the zlib default,  if neither is set.
Add --no-reuse-object if you want to force a uniform compression
level on all data no matter the source.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---no-sparse"> <a class="anchor" href="#Documentation/git-pack-objects.txt---no-sparse"></a>--[no-]sparse </dt>
<dd>
<p>Toggle the "sparse" algorithm to determine which objects to include in
the pack, when combined with the "--revs" option. This algorithm
only walks trees that appear in paths that introduce new objects.
This can have significant performance benefits when computing
a pack to send a small change. However, it is possible that extra
objects are added to the pack-file if the included commits contain
certain types of direct renames. If this option is not included,
it defaults to the value of <code>pack.useSparse</code>, which is true unless
otherwise specified.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---thin"> <a class="anchor" href="#Documentation/git-pack-objects.txt---thin"></a>--thin </dt>
<dd>
<p>Create a "thin" pack by omitting the common objects between a
sender and a receiver in order to reduce network transfer. This
option only makes sense in conjunction with --stdout.</p>
<div class="paragraph">
<p>Note: A thin pack violates the packed archive format by omitting
required objects and is thus unusable by Git without making it
self-contained. Use <code>git index-pack --fix-thin</code>
(see <a href='{{< relurl "docs/git-index-pack" >}}'>git-index-pack[1]</a>) to restore the self-contained property.</p>
</div>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---shallow"> <a class="anchor" href="#Documentation/git-pack-objects.txt---shallow"></a>--shallow </dt>
<dd>
<p>Optimize a pack that will be provided to a client with a shallow
repository.  This option, combined with --thin, can result in a
smaller pack at the cost of speed.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---delta-base-offset"> <a class="anchor" href="#Documentation/git-pack-objects.txt---delta-base-offset"></a>--delta-base-offset </dt>
<dd>
<p>A packed archive can express the base object of a delta as
either a 20-byte object name or as an offset in the
stream, but ancient versions of Git don&#8217;t understand the
latter.  By default, <em>git pack-objects</em> only uses the
former format for better compatibility.  This option
allows the command to use the latter format for
compactness.  Depending on the average delta chain
length, this option typically shrinks the resulting
packfile by 3-5 per-cent.</p>
<div class="paragraph">
<p>Note: Porcelain commands such as <code>git gc</code> (see <a href='{{< relurl "docs/git-gc" >}}'>git-gc[1]</a>),
<code>git repack</code> (see <a href='{{< relurl "docs/git-repack" >}}'>git-repack[1]</a>) pass this option by default
in modern Git when they put objects in your repository into pack files.
So does <code>git bundle</code> (see <a href='{{< relurl "docs/git-bundle" >}}'>git-bundle[1]</a>) when it creates a bundle.</p>
</div>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---threadsltngt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---threadsltngt"></a>--threads=&lt;n&gt; </dt>
<dd>
<p>Specifies the number of threads to spawn when searching for best
delta matches.  This requires that pack-objects be compiled with
pthreads otherwise this option is ignored with a warning.
This is meant to reduce packing time on multiprocessor machines.
The required amount of memory for the delta search window is
however multiplied by the number of threads.
Specifying 0 will cause Git to auto-detect the number of CPU&#8217;s
and set the number of threads accordingly.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---index-versionltversiongtltoffsetgt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---index-versionltversiongtltoffsetgt"></a>--index-version=&lt;version&gt;[,&lt;offset&gt;] </dt>
<dd>
<p>This is intended to be used by the test suite only. It allows
to force the version for the generated pack index, and to force
64-bit index entries on objects located above the given offset.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---keep-true-parents"> <a class="anchor" href="#Documentation/git-pack-objects.txt---keep-true-parents"></a>--keep-true-parents </dt>
<dd>
<p>With this option, parents that are hidden by grafts are packed
nevertheless.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---filterltfilter-specgt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---filterltfilter-specgt"></a>--filter=&lt;filter-spec&gt; </dt>
<dd>
<p>Omits certain objects (usually blobs) from the resulting
packfile.  See <a href='{{< relurl "docs/git-rev-list" >}}'>git-rev-list[1]</a> for valid
<code>&lt;filter-spec&gt;</code> forms.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---no-filter"> <a class="anchor" href="#Documentation/git-pack-objects.txt---no-filter"></a>--no-filter </dt>
<dd>
<p>Turns off any previous <code>--filter=</code> argument.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---missingltmissing-actiongt"> <a class="anchor" href="#Documentation/git-pack-objects.txt---missingltmissing-actiongt"></a>--missing=&lt;missing-action&gt; </dt>
<dd>
<p>A debug option to help with future "partial clone" development.
This option specifies how missing objects are handled.</p>
<div class="paragraph">
<p>The form <em>--missing=error</em> requests that pack-objects stop with an error if
a missing object is encountered.  If the repository is a partial clone, an
attempt to fetch missing objects will be made before declaring them missing.
This is the default action.</p>
</div>
<div class="paragraph">
<p>The form <em>--missing=allow-any</em> will allow object traversal to continue
if a missing object is encountered.  No fetch of a missing object will occur.
Missing objects will silently be omitted from the results.</p>
</div>
<div class="paragraph">
<p>The form <em>--missing=allow-promisor</em> is like <em>allow-any</em>, but will only
allow object traversal to continue for EXPECTED promisor missing objects.
No fetch of a missing object will occur.  An unexpected missing object will
raise an error.</p>
</div>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---exclude-promisor-objects"> <a class="anchor" href="#Documentation/git-pack-objects.txt---exclude-promisor-objects"></a>--exclude-promisor-objects </dt>
<dd>
<p>Omit objects that are known to be in the promisor remote.  (This
option has the purpose of operating only on locally created objects,
so that when we repack, we still maintain a distinction between
locally created objects [without .promisor] and objects from the
promisor remote [with .promisor].)  This is used with partial clone.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---keep-unreachable"> <a class="anchor" href="#Documentation/git-pack-objects.txt---keep-unreachable"></a>--keep-unreachable </dt>
<dd>
<p>Objects unreachable from the refs in packs named with
--unpacked= option are added to the resulting pack, in
addition to the reachable objects that are not in packs marked
with *.keep files. This implies <code>--revs</code>.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---pack-loose-unreachable"> <a class="anchor" href="#Documentation/git-pack-objects.txt---pack-loose-unreachable"></a>--pack-loose-unreachable </dt>
<dd>
<p>Pack unreachable loose objects (and their loose counterparts
removed). This implies <code>--revs</code>.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---unpack-unreachable"> <a class="anchor" href="#Documentation/git-pack-objects.txt---unpack-unreachable"></a>--unpack-unreachable </dt>
<dd>
<p>Keep unreachable objects in loose form. This implies <code>--revs</code>.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-pack-objects.txt---delta-islands"> <a class="anchor" href="#Documentation/git-pack-objects.txt---delta-islands"></a>--delta-islands </dt>
<dd>
<p>Restrict delta matches based on "islands". See DELTA ISLANDS
below.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delta_islands"><a class="anchor" href="#_delta_islands"></a>DELTA ISLANDS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When possible, <code>pack-objects</code> tries to reuse existing on-disk deltas to
avoid having to search for new ones on the fly. This is an important
optimization for serving fetches, because it means the server can avoid
inflating most objects at all and just send the bytes directly from
disk. This optimization can&#8217;t work when an object is stored as a delta
against a base which the receiver does not have (and which we are not
already sending). In that case the server "breaks" the delta and has to
find a new one, which has a high CPU cost. Therefore it&#8217;s important for
performance that the set of objects in on-disk delta relationships match
what a client would fetch.</p>
</div>
<div class="paragraph">
<p>In a normal repository, this tends to work automatically. The objects
are mostly reachable from the branches and tags, and that&#8217;s what clients
fetch. Any deltas we find on the server are likely to be between objects
the client has or will have.</p>
</div>
<div class="paragraph">
<p>But in some repository setups, you may have several related but separate
groups of ref tips, with clients tending to fetch those groups
independently. For example, imagine that you are hosting several "forks"
of a repository in a single shared object store, and letting clients
view them as separate repositories through <code>GIT_NAMESPACE</code> or separate
repos using the alternates mechanism. A naive repack may find that the
optimal delta for an object is against a base that is only found in
another fork. But when a client fetches, they will not have the base
object, and we&#8217;ll have to find a new delta on the fly.</p>
</div>
<div class="paragraph">
<p>A similar situation may exist if you have many refs outside of
<code>refs/heads/</code> and <code>refs/tags/</code> that point to related objects (e.g.,
<code>refs/pull</code> or <code>refs/changes</code> used by some hosting providers). By
default, clients fetch only heads and tags, and deltas against objects
found only in those other groups cannot be sent as-is.</p>
</div>
<div class="paragraph">
<p>Delta islands solve this problem by allowing you to group your refs into
distinct "islands". Pack-objects computes which objects are reachable
from which islands, and refuses to make a delta from an object <code>A</code>
against a base which is not present in all of <code>A</code>'s islands. This
results in slightly larger packs (because we miss some delta
opportunities), but guarantees that a fetch of one island will not have
to recompute deltas on the fly due to crossing island boundaries.</p>
</div>
<div class="paragraph">
<p>When repacking with delta islands the delta window tends to get
clogged with candidates that are forbidden by the config. Repacking
with a big --window helps (and doesn&#8217;t take as long as it otherwise
might because we can reject some object pairs based on islands before
doing any computation on the content).</p>
</div>
<div class="paragraph">
<p>Islands are configured via the <code>pack.island</code> option, which can be
specified multiple times. Each value is a left-anchored regular
expressions matching refnames. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[pack]
island = refs/heads/
island = refs/tags/</pre>
</div>
</div>
<div class="paragraph">
<p>puts heads and tags into an island (whose name is the empty string; see
below for more on naming). Any refs which do not match those regular
expressions (e.g., <code>refs/pull/123</code>) is not in any island. Any object
which is reachable only from <code>refs/pull/</code> (but not heads or tags) is
therefore not a candidate to be used as a base for <code>refs/heads/</code>.</p>
</div>
<div class="paragraph">
<p>Refs are grouped into islands based on their "names", and two regexes
that produce the same name are considered to be in the same
island. The names are computed from the regexes by concatenating any
capture groups from the regex, with a <em>-</em> dash in between. (And if
there are no capture groups, then the name is the empty string, as in
the above example.) This allows you to create arbitrary numbers of
islands. Only up to 14 such capture groups are supported though.</p>
</div>
<div class="paragraph">
<p>For example, imagine you store the refs for each fork in
<code>refs/virtual/ID</code>, where <code>ID</code> is a numeric identifier. You might then
configure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[pack]
island = refs/virtual/([0-9]+)/heads/
island = refs/virtual/([0-9]+)/tags/
island = refs/virtual/([0-9]+)/(pull)/</pre>
</div>
</div>
<div class="paragraph">
<p>That puts the heads and tags for each fork in their own island (named
"1234" or similar), and the pull refs for each go into their own
"1234-pull".</p>
</div>
<div class="paragraph">
<p>Note that we pick a single island for each regex to go into, using "last
one wins" ordering (which allows repo-specific config to take precedence
over user-wide config, and so forth).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>CONFIGURATION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Various configuration variables affect packing, see
<a href='{{< relurl "docs/git-config" >}}'>git-config[1]</a> (search for "pack" and "delta").</p>
</div>
<div class="paragraph">
<p>Notably, delta compression is not used on objects larger than the
<code>core.bigFileThreshold</code> configuration variable and on files with the
attribute <code>delta</code> set to false.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also"><a class="anchor" href="#_see_also"></a>SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href='{{< relurl "docs/git-rev-list" >}}'>git-rev-list[1]</a>
<a href='{{< relurl "docs/git-repack" >}}'>git-repack[1]</a>
<a href='{{< relurl "docs/git-prune-packed" >}}'>git-prune-packed[1]</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git"><a class="anchor" href="#_git"></a>GIT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part of the <a href='{{< relurl "docs/git" >}}'>git[1]</a> suite</p>
</div>
</div>
</div>