---
### DO NOT EDIT! Generated by script/update-docs.rb

category: manual
section: documentation
subsection: manual
title: Git - git-merge-tree Documentation
docname: git-merge-tree
version: 2.46.0
aliases:
- "/docs/git-merge-tree/2.46.0/index.html"
- "/docs/git-merge-tree/2.46.1/index.html"
- "/docs/git-merge-tree/2.46.2/index.html"
- "/docs/git-merge-tree/2.47.0/index.html"
---
<div class="sect1">
<h2 id="_name"><a class="anchor" href="#_name"></a>NAME</h2>
<div class="sectionbody">
<div class="paragraph">
<p>git-merge-tree - Perform merge without touching index or working tree</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis"><a class="anchor" href="#_synopsis"></a>SYNOPSIS</h2>
<div class="sectionbody">
<div class="verseblock">
<pre class="content"><em>git merge-tree</em> [--write-tree] [&lt;options&gt;] &lt;branch1&gt; &lt;branch2&gt;
<em>git merge-tree</em> [--trivial-merge] &lt;base-tree&gt; &lt;branch1&gt; &lt;branch2&gt; (deprecated)</pre>
</div>
</div>
</div>
<div class="sect1">
<h2 id="NEWMERGE"><a class="anchor" href="#NEWMERGE"></a>DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This command has a modern <code>--write-tree</code> mode and a deprecated
<code>--trivial-merge</code> mode.  With the exception of the
<a href="#DEPMERGE">DEPRECATED DESCRIPTION</a> section at the end, the rest of
this documentation describes the modern <code>--write-tree</code> mode.</p>
</div>
<div class="paragraph">
<p>Performs a merge, but does not make any new commits and does not read
from or write to either the working tree or index.</p>
</div>
<div class="paragraph">
<p>The performed merge will use the same features as the "real"
<a href='{{< relurl "docs/git-merge" >}}'>git-merge[1]</a>, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>three way content merges of individual files</p>
</li>
<li>
<p>rename detection</p>
</li>
<li>
<p>proper directory/file conflict handling</p>
</li>
<li>
<p>recursive ancestor consolidation (i.e. when there is more than one
merge base, creating a virtual merge base by merging the merge bases)</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the merge completes, a new toplevel tree object is created.  See
<code>OUTPUT</code> below for details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_options"><a class="anchor" href="#_options"></a>OPTIONS</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1" id="Documentation/git-merge-tree.txt--z"> <a class="anchor" href="#Documentation/git-merge-tree.txt--z"></a>-z </dt>
<dd>
<p>Do not quote filenames in the &lt;Conflicted file info&gt; section,
and end each filename with a NUL character rather than
newline.  Also begin the messages section with a NUL character
instead of a newline.  See <a href="#OUTPUT">OUTPUT</a> below for more information.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-merge-tree.txt---name-only"> <a class="anchor" href="#Documentation/git-merge-tree.txt---name-only"></a>--name-only </dt>
<dd>
<p>In the Conflicted file info section, instead of writing a list
of (mode, oid, stage, path) tuples to output for conflicted
files, just provide a list of filenames with conflicts (and
do not list filenames multiple times if they have multiple
conflicting stages).</p>
</dd>
<dt class="hdlist1" id="Documentation/git-merge-tree.txt---no-messages"> <a class="anchor" href="#Documentation/git-merge-tree.txt---no-messages"></a>--[no-]messages </dt>
<dd>
<p>Write any informational messages such as "Auto-merging &lt;path&gt;"
or CONFLICT notices to the end of stdout.  If unspecified, the
default is to include these messages if there are merge
conflicts, and to omit them otherwise.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-merge-tree.txt---allow-unrelated-histories"> <a class="anchor" href="#Documentation/git-merge-tree.txt---allow-unrelated-histories"></a>--allow-unrelated-histories </dt>
<dd>
<p>merge-tree will by default error out if the two branches specified
share no common history.  This flag can be given to override that
check and make the merge proceed anyway.</p>
</dd>
<dt class="hdlist1" id="Documentation/git-merge-tree.txt---merge-baselttree-ishgt"> <a class="anchor" href="#Documentation/git-merge-tree.txt---merge-baselttree-ishgt"></a>--merge-base=&lt;tree-ish&gt; </dt>
<dd>
<p>Instead of finding the merge-bases for &lt;branch1&gt; and &lt;branch2&gt;,
specify a merge-base for the merge, and specifying multiple bases is
currently not supported. This option is incompatible with <code>--stdin</code>.</p>
<div class="paragraph">
<p>As the merge-base is provided directly, &lt;branch1&gt; and &lt;branch2&gt; do not need
to specify commits; trees are enough.</p>
</div>
</dd>
<dt class="hdlist1" id="Documentation/git-merge-tree.txt--Xltoptiongt"> <a class="anchor" href="#Documentation/git-merge-tree.txt--Xltoptiongt"></a>-X&lt;option&gt; </dt>
<dt class="hdlist1" id="Documentation/git-merge-tree.txt---strategy-optionltoptiongt"> <a class="anchor" href="#Documentation/git-merge-tree.txt---strategy-optionltoptiongt"></a>--strategy-option=&lt;option&gt; </dt>
<dd>
<p>Pass the merge strategy-specific option through to the merge strategy.
See <a href='{{< relurl "docs/git-merge" >}}'>git-merge[1]</a> for details.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="OUTPUT"><a class="anchor" href="#OUTPUT"></a>OUTPUT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a successful merge, the output from git-merge-tree is simply one
line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;OID of toplevel tree&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Whereas for a conflicted merge, the output is by default of the form:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;OID of toplevel tree&gt;
&lt;Conflicted file info&gt;
&lt;Informational messages&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>These are discussed individually below.</p>
</div>
<div class="paragraph">
<p>However, there is an exception.  If <code>--stdin</code> is passed, then there is
an extra section at the beginning, a NUL character at the end, and then
all the sections repeat for each line of input.  Thus, if the first merge
is conflicted and the second is clean, the output would be of the form:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;Merge status&gt;
&lt;OID of toplevel tree&gt;
&lt;Conflicted file info&gt;
&lt;Informational messages&gt;
NUL
&lt;Merge status&gt;
&lt;OID of toplevel tree&gt;
NUL</pre>
</div>
</div>
<div class="sect2">
<h3 id="MS"><a class="anchor" href="#MS"></a>Merge status</h3>
<div class="paragraph">
<p>This is an integer status followed by a NUL character.  The integer status is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   0: merge had conflicts
   1: merge was clean
   &lt;0: something prevented the merge from running (e.g. access to repository
objects denied by filesystem)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="OIDTLT"><a class="anchor" href="#OIDTLT"></a>OID of toplevel tree</h3>
<div class="paragraph">
<p>This is a tree object that represents what would be checked out in the
working tree at the end of <code>git merge</code>.  If there were conflicts, then
files within this tree may have embedded conflict markers.  This section
is always followed by a newline (or NUL if <code>-z</code> is passed).</p>
</div>
</div>
<div class="sect2">
<h3 id="CFI"><a class="anchor" href="#CFI"></a>Conflicted file info</h3>
<div class="paragraph">
<p>This is a sequence of lines with the format</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;mode&gt; &lt;object&gt; &lt;stage&gt; &lt;filename&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The filename will be quoted as explained for the configuration
variable <code>core.quotePath</code> (see <a href='{{< relurl "docs/git-config" >}}'>git-config[1]</a>).  However, if
the <code>--name-only</code> option is passed, the mode, object, and stage will
be omitted.  If <code>-z</code> is passed, the "lines" are terminated by a NUL
character instead of a newline character.</p>
</div>
</div>
<div class="sect2">
<h3 id="IM"><a class="anchor" href="#IM"></a>Informational messages</h3>
<div class="paragraph">
<p>This section provides informational messages, typically about
conflicts.  The format of the section varies significantly depending
on whether <code>-z</code> is passed.</p>
</div>
<div class="paragraph">
<p>If <code>-z</code> is passed:</p>
</div>
<div class="paragraph">
<p>The output format is zero or more conflict informational records, each
of the form:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;list-of-paths&gt;&lt;conflict-type&gt;NUL&lt;conflict-message&gt;NUL</pre>
</div>
</div>
<div class="paragraph">
<p>where &lt;list-of-paths&gt; is of the form</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;number-of-paths&gt;NUL&lt;path1&gt;NUL&lt;path2&gt;NUL...&lt;pathN&gt;NUL</pre>
</div>
</div>
<div class="paragraph">
<p>and includes paths (or branch names) affected by the conflict or
informational message in &lt;conflict-message&gt;.  Also, &lt;conflict-type&gt; is a
stable string explaining the type of conflict, such as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Auto-merging"</p>
</li>
<li>
<p>"CONFLICT (rename/delete)"</p>
</li>
<li>
<p>"CONFLICT (submodule lacks merge base)"</p>
</li>
<li>
<p>"CONFLICT (binary)"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and &lt;conflict-message&gt; is a more detailed message about the conflict which often
(but not always) embeds the &lt;stable-short-type-description&gt; within it.  These
strings may change in future Git versions.  Some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Auto-merging &lt;file&gt;"</p>
</li>
<li>
<p>"CONFLICT (rename/delete): &lt;oldfile&gt; renamed&#8230;&#8203;but deleted in&#8230;&#8203;"</p>
</li>
<li>
<p>"Failed to merge submodule &lt;submodule&gt; (no merge base)"</p>
</li>
<li>
<p>"Warning: cannot merge binary files: &lt;filename&gt;"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>-z</code> is NOT passed:</p>
</div>
<div class="paragraph">
<p>This section starts with a blank line to separate it from the previous
sections, and then only contains the &lt;conflict-message&gt; information
from the previous section (separated by newlines).  These are
non-stable strings that should not be parsed by scripts, and are just
meant for human consumption.  Also, note that while &lt;conflict-message&gt;
strings usually do not contain embedded newlines, they sometimes do.
(However, the free-form messages will never have an embedded NUL
character).  So, the entire block of information is meant for human
readers as an agglomeration of all conflict messages.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exit_status"><a class="anchor" href="#_exit_status"></a>EXIT STATUS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a successful, non-conflicted merge, the exit status is 0.  When the
merge has conflicts, the exit status is 1.  If the merge is not able to
complete (or start) due to some kind of error, the exit status is
something other than 0 or 1 (and the output is unspecified).  When
--stdin is passed, the return status is 0 for both successful and
conflicted merges, and something other than 0 or 1 if it cannot complete
all the requested merges.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage_notes"><a class="anchor" href="#_usage_notes"></a>USAGE NOTES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This command is intended as low-level plumbing, similar to
<a href='{{< relurl "docs/git-hash-object" >}}'>git-hash-object[1]</a>, <a href='{{< relurl "docs/git-mktree" >}}'>git-mktree[1]</a>,
<a href='{{< relurl "docs/git-commit-tree" >}}'>git-commit-tree[1]</a>, <a href='{{< relurl "docs/git-write-tree" >}}'>git-write-tree[1]</a>,
<a href='{{< relurl "docs/git-update-ref" >}}'>git-update-ref[1]</a>, and <a href='{{< relurl "docs/git-mktag" >}}'>git-mktag[1]</a>.  Thus, it can be
used as a part of a series of steps such as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NEWTREE=$(git merge-tree --write-tree $BRANCH1 $BRANCH2)
test $? -eq 0 || die "There were conflicts..."
NEWCOMMIT=$(git commit-tree $NEWTREE -p $BRANCH1 -p $BRANCH2)
git update-ref $BRANCH1 $NEWCOMMIT</pre>
</div>
</div>
<div class="paragraph">
<p>Note that when the exit status is non-zero, <code>NEWTREE</code> in this sequence
will contain a lot more output than just a tree.</p>
</div>
<div class="paragraph">
<p>For conflicts, the output includes the same information that you&#8217;d get
with <a href='{{< relurl "docs/git-merge" >}}'>git-merge[1]</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>what would be written to the working tree (the
<a href="#OIDTLT">OID of toplevel tree</a>)</p>
</li>
<li>
<p>the higher order stages that would be written to the index (the
<a href="#CFI">Conflicted file info</a>)</p>
</li>
<li>
<p>any messages that would have been printed to stdout (the
<a href="#IM">Informational messages</a>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_input_format"><a class="anchor" href="#_input_format"></a>INPUT FORMAT</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>git merge-tree --stdin</em> input format is fully text based. Each line
has this format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[&lt;base-commit&gt; -- ]&lt;branch1&gt; &lt;branch2&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If one line is separated by <code>--</code>, the string before the separator is
used for specifying a merge-base for the merge and the string after
the separator describes the branches to be merged.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mistakes_to_avoid"><a class="anchor" href="#_mistakes_to_avoid"></a>MISTAKES TO AVOID</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Do NOT look through the resulting toplevel tree to try to find which
files conflict; parse the <a href="#CFI">Conflicted file info</a> section instead.
Not only would parsing an entire tree be horrendously slow in large
repositories, there are numerous types of conflicts not representable by
conflict markers (modify/delete, mode conflict, binary file changed on
both sides, file/directory conflicts, various rename conflict
permutations, etc.)</p>
</div>
<div class="paragraph">
<p>Do NOT interpret an empty <a href="#CFI">Conflicted file info</a> list as a clean
merge; check the exit status.  A merge can have conflicts without having
individual files conflict (there are a few types of directory rename
conflicts that fall into this category, and others might also be added
in the future).</p>
</div>
<div class="paragraph">
<p>Do NOT attempt to guess or make the user guess the conflict types from
the <a href="#CFI">Conflicted file info</a> list.  The information there is
insufficient to do so.  For example: Rename/rename(1to2) conflicts (both
sides renamed the same file differently) will result in three different
files having higher order stages (but each only has one higher order
stage), with no way (short of the <a href="#IM">Informational messages</a> section)
to determine which three files are related.  File/directory conflicts
also result in a file with exactly one higher order stage.
Possibly-involved-in-directory-rename conflicts (when
"merge.directoryRenames" is unset or set to "conflicts") also result in
a file with exactly one higher order stage.  In all cases, the
<a href="#IM">Informational messages</a> section has the necessary info, though it
is not designed to be machine parseable.</p>
</div>
<div class="paragraph">
<p>Do NOT assume that each path from <a href="#CFI">Conflicted file info</a>, and
the logical conflicts in the <a href="#IM">Informational messages</a> have a
one-to-one mapping, nor that there is a one-to-many mapping, nor a
many-to-one mapping.  Many-to-many mappings exist, meaning that each
path can have many logical conflict types in a single merge, and each
logical conflict type can affect many paths.</p>
</div>
<div class="paragraph">
<p>Do NOT assume all filenames listed in the <a href="#IM">Informational messages</a>
section had conflicts.  Messages can be included for files that have no
conflicts, such as "Auto-merging &lt;file&gt;".</p>
</div>
<div class="paragraph">
<p>AVOID taking the OIDS from the <a href="#CFI">Conflicted file info</a> and
re-merging them to present the conflicts to the user.  This will lose
information.  Instead, look up the version of the file found within the
<a href="#OIDTLT">OID of toplevel tree</a> and show that instead.  In particular,
the latter will have conflict markers annotated with the original
branch/commit being merged and, if renames were involved, the original
filename.  While you could include the original branch/commit in the
conflict marker annotations when re-merging, the original filename is
not available from the <a href="#CFI">Conflicted file info</a> and thus you would
be losing information that might help the user resolve the conflict.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="DEPMERGE"><a class="anchor" href="#DEPMERGE"></a>DEPRECATED DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Per the <a href="#NEWMERGE">DESCRIPTION</a> and unlike the rest of this
documentation, this section describes the deprecated <code>--trivial-merge</code>
mode.</p>
</div>
<div class="paragraph">
<p>Other than the optional <code>--trivial-merge</code>, this mode accepts no
options.</p>
</div>
<div class="paragraph">
<p>This mode reads three tree-ish, and outputs trivial merge results and
conflicting stages to the standard output in a semi-diff format.
Since this was designed for higher level scripts to consume and merge
the results back into the index, it omits entries that match
&lt;branch1&gt;.  The result of this second form is similar to what
three-way <em>git read-tree -m</em> does, but instead of storing the results
in the index, the command outputs the entries to the standard output.</p>
</div>
<div class="paragraph">
<p>This form not only has limited applicability (a trivial merge cannot
handle content merges of individual files, rename detection, proper
directory/file conflict handling, etc.), the output format is also
difficult to work with, and it will generally be less performant than
the first form even on successful merges (especially if working in
large repositories).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git"><a class="anchor" href="#_git"></a>GIT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part of the <a href='{{< relurl "docs/git" >}}'>git[1]</a> suite</p>
</div>
</div>
</div>